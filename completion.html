<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MoveMaster OS - Enterprise Job Console</title>
    <style>
        :root { --sidebar-bg: #1a1f2b; --primary: #f97316; --header-blue: #4b6cb7; --green-bar: #2e7d32; --purple: #8e24aa; --bg: #eaeff7; }
        body { font-family: Arial, sans-serif; margin: 0; display: flex; height: 100vh; background: var(--bg); overflow: hidden; }
        
        /* SIDEBAR NAVIGATION */
        .sidebar { width: 260px; background: var(--sidebar-bg); color: white; display: flex; flex-direction: column; padding: 20px 0; flex-shrink: 0; }
        .logo-section { padding: 0 20px 30px; display: flex; align-items: center; gap: 12px; font-weight: 800; color: var(--primary); font-size: 1.2rem; }
        .nav-item { padding: 12px 25px; color: #cbd5e1; text-decoration: none; display: flex; align-items: center; gap: 15px; font-size: 0.9rem; }
        .nav-item:hover, .nav-item.active { background: rgba(255,255,255,0.05); color: white; }
        .nav-item.active { border-left: 4px solid var(--primary); color: var(--primary); }

        /* MAIN CONSOLE AREA */
        .main-workspace { flex: 1; padding: 15px; overflow-y: auto; }
        .console { max-width: 1200px; margin: auto; background: white; border: 4px solid var(--header-blue); border-radius: 4px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .header { background: var(--header-blue); color: white; padding: 10px 15px; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }
        
        .toolbar { background: #d3dae8; padding: 5px; display: flex; gap: 2px; border-bottom: 2px solid #999; }
        .toolbar button { background: #e0e0e0; border: 1px solid #999; padding: 4px 12px; font-size: 11px; font-weight: bold; cursor: pointer; color: #003366; }
        
        .section-bar { background: var(--green-bar); color: white; padding: 6px; text-align: center; font-weight: bold; text-transform: uppercase; font-size: 12px; margin: 10px 0; }
        .main-grid { display: grid; grid-template-columns: 2.8fr 1.2fr; gap: 15px; padding: 15px; }
        input, select { border: 1px solid #ccc; padding: 4px; font-size: 12px; width: 100%; box-sizing: border-box; }
        .box { background: #fffce0; border: 1px solid #999; padding: 10px; border-radius: 4px; }
        
        .card { background: var(--purple); color: white; padding: 12px; border-radius: 4px; margin-bottom: 10px; text-align: center; }
        .card label { display: block; font-weight: bold; margin-bottom: 4px; text-transform: uppercase; font-size: 10px; }
        .btn-action { width: 100%; border: none; color: white; padding: 10px; font-weight: bold; border-radius: 4px; cursor: pointer; margin-top: 5px; }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="logo-section">üöö MOVE MASTERS</div>
        <a href="index.html" class="nav-item">üìä Dashboard</a>
        <a href="#" class="nav-item">üë• Leads Pipeline</a>
        <a href="#" class="nav-item">‚ûï New Lead</a>
        <a href="calendar.html" class="nav-item">üóìÔ∏è Schedule / Calendar</a>
        <a href="completion.html" class="nav-item active">üßÆ Estimates</a>
        <a href="#" class="nav-item">üì¶ Active Jobs</a>
        <a href="#" class="nav-item">üöõ Trucks & Fleet</a>
        <a href="#" class="nav-item">üìÇ Inventory</a>
    </div>

    <div class="main-workspace">
        <div class="console">
            <div class="header">
                <span>MoveMaster OS - Job Completion Console</span>
                <button onclick="saveAndExit()" style="background:#cc0000; color:white; border:none; padding:4px 10px; cursor:pointer;">EXIT</button>
            </div>
            
            <div class="toolbar">
                <button>Charges</button><button>Delivery</button><button onclick="window.print()">Print Slip</button><button>Wages</button>
            </div>

            <div class="main-grid">
                <div class="content-area">
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                        <div class="box"><div class="section-bar">Moving From</div><input type="text" id="f-name"></div>
                        <div class="box"><div class="section-bar">Moving To</div><input type="text" id="t-name"></div>
                    </div>

                    <div class="section-bar">Trucks & Fleet Assignment</div>
                    <div class="box" style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                        <div>
                            <label style="font-size:11px; font-weight:bold;">Assign Truck:</label>
                            <select id="m-truck">
                                <option>Truck #104 (26ft Box)</option>
                                <option>Truck #202 (Sprinter)</option>
                                <option>Truck #309 (Semi)</option>
                            </select>
                        </div>
                        <div>
                            <label style="font-size:11px; font-weight:bold;">Lead Driver:</label>
                            <input type="text" id="m-driver" placeholder="Enter Driver Name">
                        </div>
                    </div>

                    <div class="section-bar" style="margin-top:15px">Financial Audit</div>
                    <div class="box">
                        <table style="width:100%;">
                            <tr><td>Actual Volume (cf)</td><td><input type="number" id="p-av" oninput="recalc()"></td><td style="text-align:right; font-weight:bold; color:red;" id="res-final">$0.00</td></tr>
                        </table>
                    </div>
                </div>

                <div class="sidebar-cards">
                    <div class="card"><label>Permanent Job ID</label><div id="m-id" style="font-size:1.3rem; font-weight:900;">--</div></div>
                    <div class="card" style="background:#000; color:#00ff00;"><label>NET MARGIN</label><span id="profit-val" style="font-size:1.3rem; font-weight:bold;">$0.00</span></div>
                    <button onclick="saveAndExit()" class="btn-action" style="background:var(--green-bar);">Finalize Completion</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        let db = JSON.parse(localStorage.getItem('mm_enterprise_db')) || [];
        const idx = new URLSearchParams(window.location.search).get('id');
        
        function load() {
            if(idx !== null && db[idx]) {
                const l = db[idx];
                document.getElementById('m-id').innerText = l.id || 'N/A';
                document.getElementById('f-name').value = l.n || '';
                document.getElementById('p-av').value = l.av || 0;
                document.getElementById('m-driver').value = l.driver || '';
                document.getElementById('m-truck').value = l.truck || 'Truck #104 (26ft Box)';
            }
            recalc();
        }
        
        function recalc() {
            const av = parseFloat(document.getElementById('p-av').value) || 0;
            const total = av * 3;
            document.getElementById('res-final').innerText = "$" + total.toFixed(2);
            document.getElementById('profit-val').innerText = "$" + total.toFixed(2);
        }

        function saveAndExit() {
            if(idx !== null) {
                db[idx].n = document.getElementById('f-name').value;
                db[idx].av = document.getElementById('p-av').value;
                db[idx].driver = document.getElementById('m-driver').value;
                db[idx].truck = document.getElementById('m-truck').value;
                localStorage.setItem('mm_enterprise_db', JSON.stringify(db));
            }
            window.location.href = 'index.html';
        }
        window.onload = load;
    </script>
</body>
</html>
